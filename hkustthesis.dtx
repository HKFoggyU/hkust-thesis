% \iffalse meta-comment
% !TeX program  = XeLaTeX
% !TeX encoding = UTF-8
%
% Copyright (C) 2021-2023 
% by <HKFoggyU> @ GitHub
% 
% It may be distributed and/or modified under the conditions of the
% LaTeX Project Public License (LPPL), either version 1.3c of this
% license or (at your option) any later version.  The latest version
% of this license is in the file
%
%    https://www.latex-project.org/lppl.txt
%
% -----------------------------------------------------------------------
%
% The development version of the template can be found at
%
%    https://github.com/HKFoggyU/hkust-thesis
%
% for those people who are interested.
%
%<*internal>
\iffalse
%</internal>
%
%<*internal>
\fi
\begingroup
  \def\NameOfLaTeXe{LaTeX2e}
\expandafter\endgroup\ifx\NameOfLaTeXe\fmtname\else
\csname fi\endcsname
%</internal>
%
%<*install>
\input l3docstrip.tex
\keepsilent
\askforoverwritefalse

\preamble

Copyright (C) 2021-2023
by <HKFoggyU> @ GitHub

This file may be distributed and/or modified under the conditions of
the LaTeX Project Public License, either version 1.3 of this license
or (at your option) any later version.  The latest version of this
license is in:

   http://www.latex-project.org/lppl.txt

and version 1.3 or later is part of all distributions of LaTeX version
2005/12/01 or later.

To produce the documentation run the original source files ending with `.dtx'
through XeTeX.
    
\endpreamble

\generate{
  \usedir{tex/latex/hkustthesis}
    \file{\jobname.cls}        {\from{\jobname.dtx}{class}}
%</install>
%<*internal>
  \usedir{source/latex/hkustthesis}
    \file{\jobname.ins}        {\from{\jobname.dtx}{install}}
%</internal>
%<*install>
}

\obeyspaces
\Msg{**************************************************************}
\Msg{*                                                            *}
\Msg{* To finish the installation you have to move the following  *}
\Msg{* files into a directory searched by TeX:                    *}
\Msg{*                                                            *}
\Msg{* The recommended directory is TDS:tex/latex/hkustthesis     *}
\Msg{*                                                            *}
\Msg{*     hkustthesis.cls                                        *}
\Msg{*     hkustthesis.ins                                        *}
\Msg{*                                                            *}
\Msg{* To produce the documentation, run the file hkustthesis.dtx *}
\Msg{* through XeLaTeX.                                           *}
\Msg{*                                                            *}
\Msg{* Happy TeXing!                                              *}
\Msg{*                                                            *}
\Msg{**************************************************************}

\endbatchfile
%</install>
%
%<*internal>
\fi
%</internal>
%
%<class>\NeedsTeXFormat{LaTeX2e}
%<class>\RequirePackage{expl3}
%<class>\GetIdInfo  $Id: hkustthesis.dtx 0.8.3 2023-12-12 00:00:00 +0800  HKFoggyU$
%<class>  { Thesis template for HKUST }
%<class>\ProvidesExplClass{hkustthesis}
%<class>{\ExplFileDate}{\ExplFileVersion}{\ExplFileDescription}
%
%<*driver>
\ProvidesFile{hkustthesis.dtx}
\documentclass[12pt]{ctxdoc}
\usepackage{float,footnote,fontawesome,graphicx,listings,soul,xcolor,tabularray}
\setlist[1]{labelindent=0.5em}
\UseTblrLibrary{booktabs,siunitx,diagbox}
\DefTblrTemplate{caption-tag}{default}{Table~\hspace{0.25em}\thetable}
\SetTblrStyle{caption-tag}{font=\bfseries}
\DefTblrTemplate{caption-sep}{default}{\quad}

\definecolor{warning}{RGB}{255, 0, 0}
\definecolor{hkustblue}{RGB}{0, 51, 102}
\definecolor{hkustgold}{RGB}{153, 102, 0}
\definecolor{hkustred}{RGB}{237, 27, 47}
\definecolor{hkustgray}{RGB}{204, 204, 204}
\definecolor{hkustviolet}{RGB}{124, 35, 72}
\definecolor{hkustyellow}{RGB}{255, 212, 0}
\definecolor{code-bg}{RGB}{225, 225, 225}
\definecolor{vsc-compile-failed}{RGB}{237, 136, 151}

%% Self-defined helping macros
\NewDocumentCommand\mycomment{m}{{\color{gray}#1}}
\NewDocumentCommand\myoptional{m}{\textcolor{hkustblue}{#1}}
\NewDocumentCommand\mywarning{m}{{\color{red}#1}}
\NewDocumentCommand\myblock{m}{{\colorbox{code-bg}{#1}}}
\NewDocumentCommand\myVee{}{\raisebox{1pt}{\scalebox{1.5}[0.7]{$\vee$}}}
\NewDocumentCommand\VSCodeCompiling{}{\rlap{\rotatebox[origin=c]{90}{$\circlearrowright$}}\rotatebox[origin=c]{-90}{$\circlearrowright$}}
\NewDocumentCommand\VSCodeCompileSucceed{}{\faCheck}
\NewDocumentCommand\VSCodeCompileFailed{}{{\color{vsc-compile-failed}{\faTimes}}}
\renewcommand\contentsname{\color{red}目录 Contents}

\pagestyle{plain}

\lstset{basicstyle=\ttfamily, language=TeX, backgroundcolor=\color{code-bg}}

\DoNotIndex{\\}
\begin{document}
  \DocInput{hkustthesis.dtx}
  \clearpage
  \PrintChanges
  \clearpage
  \PrintIndex
\end{document}
%</driver>
% \fi
%
% \def\twodigits#1{\ifnum#1<10 0\fi\the#1}
% \def\dashedtoday{\leavevmode\hbox{\the\year-\twodigits\month-\twodigits\day}}
%
% \title{\color{hkustblue}{The \textsc{HkustThesis} class\\ A \hologo{LaTeX}\textcolor{hkustred}{3} template}}
% 
% \author{\href{https://github.com/HKFoggyU}{\color{black}{\faGithub~@HKFoggyU}}}
%
% \date{v0.8.4 @ \dashedtoday\\
% {\footnotesize 请确保阅读本文档的\href{https://github.com/HKFoggyU/hkust-thesis/releases}{最新版本}}\\
% {\footnotesize Please read the \href{https://github.com/HKFoggyU/hkust-thesis/releases}{latest version} of this documentation}
% }
%
% \changes{v0.1}{2021/10/21}{Start development based on \href{https://github.com/nju-lug/NjuThesis}{\textsc{NjuThesis}} class}
% \changes{v0.2}{2021/10/24}{Typesett page stye before main body}
% \changes{v0.3}{2021/10/26}{Change \pkg{cref} settings; add some doc}
% \changes{v0.4}{2021/10/27}{Change theorem environment; make the title name of paperlist customizable}
% \changes{v0.4.1}{2021/10/29}{Add documentation for preamble}
% \changes{v0.4.2}{2021/10/31}{Complete documentation}
% \changes{v0.4.3}{2021/11/01}{Fix typos in documentation}
% \changes{v0.5}{2021/11/05}{Add optional TEC list}
% \changes{v0.5.3}{2021/11/06}{Update documentation about TEC list}
% \changes{v0.5.4}{2021/11/08}{Fix loop ending condition for TEC list}
% \changes{v0.6}{2021/11/09}{Update line spacing according to GS, change to oneside, fine tune signature page for different cases}
% \changes{v0.6.1}{2021/11/09}{Fix TEC external examiner problem}
% \changes{v0.6.2}{2021/11/10}{Fix bm conflicts, merge supervisor title into name, update docs}
% \changes{v0.6.3}{2021/11/17}{Change to Co-supervisor, remove supervisor tile name, optimize code performance and style}
% \changes{v0.7.0}{2021/11/23}{cref format issue, bib style, docs and logo}
% \changes{v0.7.1}{2023/08/17}{add presnum in lof and lot, fix typos}
% \changes{v0.7.2}{2023/08/26}{fix vscode setting bug, fix qty conflicts, more friendly docs}
% \changes{v0.7.3}{2023/11/23}{fix twoside bug, default to twoside, fix RPG Handbook link}
% \changes{v0.7.4}{2023/12/01}{fix false typo, add blankpage option, remove redundant setting items, update docs}
% \changes{v0.8.0}{2023/12/04}{update docs about Overleaf part, bump version due to blankpage}
% \changes{v0.8.1}{2023/12/08}{add missing author term}
% \changes{v0.8.2}{2023/12/09}{add English docs}
% \changes{v0.8.3}{2023/12/12}{add missing blankpage var, update typo in docs}
% \changes{v0.8.4}{2024/05/06}{Remove conflict-casuing \pkg{floatrow}, try add list of algorithms}
%
% {
% \phantomsection
% \addcontentsline{toc}{section}{封面 Cover}
% \maketitle
% }
%
% \def\abstractname{简介 Introduction}
% \begin{abstract}
% \textsc{HkustThesis} 文档类 (class) 意在为香港科技大学 (HKUST) 的研究型硕士 (MPhil) 和博士 (PhD) 生提供一个尽可能符合 \href{https://fytgs.hkust.edu.hk/academics/Academic-Regulations-and-Requirements/Handbook-for-Research-Postgraduate-Studies/guidelines-thesis-preparation}{RPG Handbook} 要求的毕业论文\hologo{LaTeX}模板。
%
% \textsc{HkustThesis} class aims to provide a \hologo{LaTeX} thesis template that tries best to meet the requirements of the \href{https://fytgs.hkust.edu.hk/academics/Academic-Regulations-and-Requirements/Handbook-for-Research-Postgraduate-Studies/guidelines-thesis-preparation}{RPG Handbook} for the RPG students (MPhil/PhD) of HKUST.
% \end{abstract}
%
% \vspace{1\baselineskip}
% \def\abstractname{免责声明 Disclamer}
% \begin{abstract}
% 本模板并非官方模板。事实上，除极个别系外，FYTGS 只提供 RPG Handbook 作为总体要求，并不存在官方模板。本模板对潜在的漏洞或与 RPG Handbook 的要求不符的情况不负任何责任。本模板仍在开发中，请从本项目的 \href{https://github.com/HKFoggyU/hkust-thesis/}{GitHub 仓库} 获取更新。
%
% This template is not an official template. In fact, there is no official template except for some certain departments. The FYTGS only provide requirements in RPG Handbook as guidelines. This template takes no responsibility for any potential inconsistency. This template is under development, and please get the latest updates from the \href{https://github.com/HKFoggyU/hkust-thesis/}{GitHub repo} of this project.
% \end{abstract}
%
% \vspace{1\baselineskip}
% \def\abstractname{致谢 Acknowledgements}
% \begin{abstract}
% 本项目基于 \href{https://github.com/nju-lug/NjuThesis}{\textsc{NjuThesis}} 项目开发，并得到了 \href{https://github.com/nju-lug}{NJU LUG} 的帮助。
%
% This project is developed based on \href{https://github.com/nju-lug/NjuThesis}{\textsc{NjuThesis}} and received help from \href{https://github.com/nju-lug}{NJU LUG}.
% \end{abstract}
%%
% \clearpage
%
% \setcounter{tocdepth}{4}
% \tableofcontents
% \clearpage
%
% \EnableDocumentation
%^^A \DisableDocumentation
% 
% \begin{documentation}
%
% \section{模板介绍 Introduction to this template}\label{sec:introduction}
% \textsc{HkustThesis}是由GitHub组织 \href{https://github.com/HKFoggyU}{@HKFoggyU} 维护的用于香港科技大学研究型硕士 (MPhil) 和博士 (PhD) 生毕业论文排版的\hologo{LaTeX}模板。
%
% \textsc{HkustThesis} is developed and maintained by GitHub organization \href{https://github.com/HKFoggyU}{@HKFoggyU} for typesetting thesis for the RPG (MPhil and PhD) students in HKUST.
%
% \subsection{动机 Motivation}
% GitHub上已有数个由热心校友（包括但不限于\href{https://github.com/wenbinf/hkust-mphil-thesis}{@wenbinf}、\href{https://github.com/onlytailei/HKUST_latex_thesis_2019}{@onlytailei}、\href{https://github.com/fcyu/HKUST_PhD_MPhil_thesis_Latex}{@fcyu}、\href{https://github.com/Cheedoong/hkust-latex-thesis}{@cheedoong}）制作的毕业论文\hologo{LaTeX}模板。这些模板均使用\hologo{LaTeX2e}语法编写，有些编写时间久远，缺少必要的文档，鲜有后续更新和维护。
%
% 随着时代的进步，更加清晰简明的\hologo{LaTeX3}大大提高了模板的易读性与可维护性\footnote{相比于\hologo{LaTeX2e}；但体验过Typst之后：Typst真香！}。因此，HKFoggyU的成员决定通过\hologo{LaTeX3}语法、参考其它优秀项目，合作编写并维护一个全新的毕业论文模板。
%
% There are several thesis templates developed by alumni of HKUST on GitHub, including but not limited to: \href{https://github.com/wenbinf/hkust-mphil-thesis}{@wenbinf}, \href{https://github.com/onlytailei/HKUST_latex_thesis_2019}{@onlytailei}, \href{https://github.com/fcyu/HKUST_PhD_MPhil_thesis_Latex}{@fcyu}, \href{https://github.com/Cheedoong/hkust-latex-thesis}{@cheedoong}. These templates are all developed with \hologo{LaTeX2e}, among which were developed at a long time ago and lacking necessary documentation and maintenance.
%
% The development of \hologo{LaTeX3} with clearer syntax improves the legibility and maintainability of \hologo{LaTeX} templates\footnote{compared to \hologo{LaTeX2e}. But Typst is another promising tool!}. @HKFoggyU decides to develop a new thesis template with \hologo{LaTeX3} with the help from previous good projects.
%
% \subsection{文档结构 Documentation structure}
% 本文档的前半部分（第\ref{sec:introduction}-\ref{sec:intro2thesis}节）为用户手册，供使用本模板撰写毕业论文的同学们参考。其中，第\ref{sec:preparations}-\ref{sec:compile}节介绍了\hologo{LaTeX}和本模板的工具，有\hologo{LaTeX}基础的用户可以跳过；第\ref{sec:intro2thesis}节详细介绍了如何使用本模板撰写毕业论文，建议仔细阅读。
%
% 后半部分（第\ref{sec:implementation}节及以后）为开发手册，供有意了解或贡献源码的开发者参考，普通用户无需阅读。
%
% Section \ref{sec:introduction}-\ref{sec:intro2thesis} of this document form the user manual as the reference for the users writing their thesis with this template. Section \ref{sec:preparations}-\ref{sec:compile} introduce \hologo{LaTeX} and some related tools, which can be skipped during reading if the reader is familiar with \hologo{LaTeX}. Section \ref{sec:intro2thesis} introduces in detail how to use this template for writing the thesis.
%
% The contents after Section \ref{sec:implementation} are the developing manual for interested developers. General users don't need to read them.
%
% \clearpage
%
% \section{工欲善其事，必先利其器 Preparations before start}\label{sec:preparations}
%
% 在使用本模板写作毕业论文前，你需要准备以下几点。
%
% \mycomment{有\hologo{LaTeX}基础的用户可以跳过本节。}
%
% You need to prepare the following things before composing thesis using this template.
%
% \mycomment{Users with \hologo{LaTeX} experiences can skip this section.}
%
% \subsection{\hologo{LaTeX}入门 Introduction to \hologo{LaTeX}}
% ``\emph{授人以鱼不如授人以渔。}''
% 本节将更侧重入门\hologo{LaTeX}的方法而非具体步骤。
%
% 对于新手，\href{https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes}{Overleaf的30分钟快速入门}已经是一个非常友好的入门教程。在此基础上，如果想更多了解一些，复旦大学曾祥东的\href{https://github.com/stone-zeng/latex-talk}{《现代\hologo{LaTeX}入门讲座》}（PPT，$\approx$ 1 小时）和北京大学刘海洋的 \href{https://www.bilibili.com/video/BV1s7411U7Pr}{\hologo{LaTeX}不快速的入门}（视频讲座，$\approx$ 3 小时）是两个非常优秀的入门教程；推荐先通读前者，如果不喜欢文字内容，可以观看后者。另外，刘海洋的《\hologo{LaTeX}入门》内容详尽充实，可以作为日常写作时的工具书。
%
% ``\emph{吾生也有涯，而知也无涯。}''
% \hologo{LaTeX}的参考资料浩如烟海。没有人能把这些资料都看完才去开始使用\hologo{LaTeX}，因此，学会使用 Google/ChatGPT 等工具解决眼前的问题，比通读各种\hologo{LaTeX}教程更加重要。
%
% 作为新手用户，不要有 ``\hologo{LaTeX}要写代码'' 这种思想负担，也不要害怕编译报错，这些不影响之前输入的文字\footnote{比Word突然卡死崩溃不知道好到哪里去了（}，遇到问题去Google或者问ChatGPT即可。
%
% This subsection will focus more on how to learn \hologo{LaTeX} by yourself instead of teaching you step by step.
% For beginners, \href{https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes}{Learn LaTeX in 30 minutes from Overleaf} is already a very good introductory material. The book \emph{A short introduction to LaTeX: A book for beginners} is a also good and more comprehensive learning resource.
% There are tons of learning materials for \hologo{LaTeX}, and they can be too overwhelming for beginners. But one can always turn to Google or ChatGPT for help when you encounter problems without reading through any learning materials.
%
% Never feel afraid of ``coding''. It is just another format of typing words into the computer.
%
% \subsection{选择\hologo{LaTeX}环境 Choose \hologo{LaTeX} environment}
% \subsubsection{在线编译 Compile online}
% 如果电脑上还未安装任何\hologo{LaTeX}发行版，可以使用在线版\hologo{LaTeX}服务 \href{https://www.overleaf.com/}{Overleaf} 进行初步体验，以避免学习热情被安装配置环境所熄灭。可以直接跳转到第\ref{sec:intro2thesis}节继续阅读。
%
% \mywarning{注意：} Overleaf免费版开始对文章长度和项目大小逐渐施加限制，近期\footnote{2023年11月}毕业的同学反映，其 thesis 项目\footnote{95页，80 MB总大小}已经需要购买会员服务。因此建议准备一份本地安装的\hologo{LaTeX}发行版以防万一。
%
% If there is no \hologo{LaTeX} distribution (software) installed on the computer, you can try with the online \hologo{LaTeX} service \href{https://www.overleaf.com/}{Overleaf} to avoid the trouble of installing \hologo{LaTeX} on your local computer.
%
% \mywarning{Attention: } Overleaf (free version) starts to post limit on the article pages and project size. According to a certain student graduated recently\footnote{November, 2023}, she needs to pay for the premium package for her thesis project \footnote{95 pages, 80 MB total size} otherwise she could not compile the project on Overleaf.
%
% \subsubsection{本地编译 Compile locally}
% 如果希望不依赖网络工作，请选择 \href{https://www.tug.org/texlive/}{\hologo{TeXLive}} \textbf{或} \href{https://miktex.org/download}{\hologo{MiKTeX}}，点击下载并安装其最新版本。前者安装体积较大（$\approx$ 5 GB）但是可以做到完全离线使用；后者体积较小（$\approx$ 1 GB）但在第一次编译时需要联网下载宏包（后续编译无需联网）。
%
% 本模板要求的\hologo{LaTeX}版本为 \hologo{TeXLive} ($\geq$2021) 或 \hologo{MiKTeX} ($\geq$4.4)。本模板在各平台、各\hologo{LaTeX}发行版上的编译情况如表 (\ref{tab:environment}) 所示。
%
% \begin{table}[ht]
%   \caption{不同平台编译测试结果\\Compiling tests results on different platforms}
%   \label{tab:environment}
%   \centering
%   \begin{tabular}{lll}
%     \toprule
%     Platform & TeX & Test \\
%     \midrule
%     Overleaf                 & \hologo{TeX}\,Live 2021/2/3  & Pass \\
%     Arch Linux (2023.11)     & \hologo{TeX}\,Live           & Pass \\
%     Windows 10/11            & \hologo{TeX}\,Live 2021      & Pass \\
%     macOS 10.15              & \hologo{TeX}\,Live 2021      & Pass \\
%     Windows 10               & \hologo{TeX}\,Live 2020      & \mywarning{\verb|ltxhook| problem} \\
%     Ubuntu 20.04             & \hologo{TeX}\,Live 2021      & Pass \\
%     Windows 11               & \hologo{MiKTeX} 4.9          & Pass \\
%     Windows 10               & \hologo{MiKTeX} 4.4          & Pass \\
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% If you want to compose the thesis independent to Internet connection, please download and install one of the following choices (click to download): \href{https://www.tug.org/texlive/}{\hologo{TeXLive}} \textbf{or} \href{https://miktex.org/download}{\hologo{MiKTeX}}. The former takes much larger disk space ($\approx$ 5 GB) and can work totally independent to Internet connection while the latter takes less disk space ($\approx$ 1 GB) but will need to download the packages at the first time run (can work offline the next time).
%
% This template requires the version of \hologo{LaTeX} to be greater than or equal to: \hologo{TeXLive} ($\geq$2021) or \hologo{MiKTeX} ($\geq$4.4). The compiling tests with different distributions on different platforms are shown in Table (\ref{tab:environment}).
%
% \subsection{编辑器 Editors} \label{sec:editors}
% \mycomment{本小节仅针对本地编译用户。Overleaf 用户使用浏览器，无需安装编辑器。}
%
% \mycomment{This subsection is for local compilation only. Overleaf users don't need a local editor.}
%
% 本项目建议使用的编辑器为 \href{https://code.visualstudio.com/download}{Visual Studio Code} （点击下载）并安装 \href{https://marketplace.visualstudio.com/items?itemName=James-Yu.latex-workshop}{LaTeX Workshop} 插件以获得良好的编辑体验。同时如有需求，可以安装\href{https://marketplace.visualstudio.com/items?itemName=MS-CEINTL.vscode-language-pack-zh-hans}{中文语言包}。
%
% 此外，建议使用支持热重载（热刷新）的 PDF 阅读器如 \href{https://www.sumatrapdfreader.org/download-free-pdf-viewer}{Sumatra PDF}（点击下载）。不支持热重载的 PDF 阅读器如 Adobe Acrobat 在打开 pdf 文件后就会锁定 pdf 修改权限，必须关闭才能更新 pdf，因此不便于此场景使用。
%
% This project suggests using \href{https://code.visualstudio.com/download}{Visual Studio Code} (click to download) as the editor. We also suggest installing the VSCode extension: \href{https://marketplace.visualstudio.com/items?itemName=James-Yu.latex-workshop}{LaTeX Workshop} to get good writing experience.
%
% In addition, we suggest using a PDF viewer that supports hot-reloading function, like \href{https://www.sumatrapdfreader.org/download-free-pdf-viewer}{Sumatra PDF} (click to download) to allow you to view the PDF file when editing the \hologo{TeX} files. If you use some PDF viewers that do not support hot-reloading, like Adobe Acrobat, the PDF file will be locked once opened, preventing it from being updated after compilation.
%
% \vfill
%
% \textbf{请确保已经完成上述准备，尤其是\hologo{LaTeX}环境。}
%
% \textbf{Please make sure you have done the above preparation items, especially the \hologo{LaTeX} environment.}
%
% \clearpage
%
% \section{编译 Compile}\label{sec:compile}
%
% \subsection{在线编译 Compile online}
% \begin{enumerate}
%  \item 请先登录Overleaf，访问本模板的 \href{https://www.overleaf.com/latex/templates/hkustthesis/mstwvckmhmjg}{Overleaf 页面}，点击 ``Open as Template''，即可以此为模板创建你自己的thesis项目。
%  \item 点击左上方 ``Menu/菜单'' 按钮，在 ``settings/设置'' 中选择如下设置：
%   \begin{itemize}
%    \item Compiler: XeLaTeX
%   \end{itemize}
%  \item 返回项目页面，点击 `` Recompile/重新编译 '' 按钮进行编译。
% \end{enumerate}
%
% \begin{enumerate}
%  \item Please log into Overleaf; visit the \href{https://www.overleaf.com/latex/templates/hkustthesis/mstwvckmhmjg}{Overleaf page} of this template; click ``Open as Template'' to create your own thesis project based on this template.
%  \item Click the  ``Menu'' button; go to ``settings'' and choose the following setting:
%   \begin{itemize}
%    \item Compiler: XeLaTeX
%   \end{itemize}
%  \item Go back to the project page; click `` Recompile '' button to compile the thesis paper.
% \end{enumerate}
%
% \subsection{本地编译 Compile locally}
% \subsubsection{获取本模板 Obtain this template}
% \begin{itemize}
% \item (针对一般用户) 请在本项目的 \href{https://github.com/HKFoggyU/hkust-thesis/releases/latest}{GitHub Release} 页面下载名为 \file{hkust-thesis-v*.zip} 的压缩文件并解压，得到名为 \file{hkust-thesis-v*} 的文件夹，这是写作毕业论文的文件夹。可以根据喜好重命名。
% \item (针对开发者) 如果希望第一时间获取更新或参与开发，可以克隆本项目\href{https://github.com/HKFoggyU/hkust-thesis.git}{仓库}，并运行 \colorbox{code-bg}{\lstinline|xetex hkustthesis.dtx|} 以生成 \file{hkustthesis.cls} 文件。
% \end{itemize}
%
% \begin{itemize}
% \item (For General users) Please download the \file{hkust-thesis-v*.zip} file from the \href{https://github.com/HKFoggyU/hkust-thesis/releases/latest}{GitHub Release} page. Unzip it and you will get a folder, which will be the working folder for you to work on your thesis from now on. You can rename the folder to your preferred name.
% \item (For developers) If you want to get latest changes or to participate in the development, clone the \href{https://github.com/HKFoggyU/hkust-thesis.git}{GitHub repo}, and run \myblock{\lstinline|xetex hkustthesis.dtx|} to extract the \file{hkustthesis.cls}.
% \end{itemize}
%
% \subsubsection{推荐编译方式 Recommended compile method}
% 本项目推荐使用 VSCode 作为编辑器和编译前端。关于 VSCode 的安装和其必要插件\href{https://marketplace.visualstudio.com/items?itemName=James-Yu.latex-workshop}{LaTeX Workshop}，请参考\ref{sec:editors}节。本项目提供了一份 配置好的 \file{.vscode/settings.json} 文件。
%
% 使用 VSCode 打开刚刚解压得到的文件夹（快捷键：\myblock{Ctrl k + Ctrl o}），点击左侧栏的 \hologo{TeX} 图标（需要安装 LaTeX Workshop 插件） ，在 \myblock{\myVee~COMMANDS} 项目下的 \myblock{\myVee~~$\triangleright$~~Build LaTeX project} 项中选择 \myblock{{\color{green}$\triangleright$} Recipe: build_mythesis}，点击其左侧的绿色三角形 \myblock{{\color{green}$\triangleright$}} 即可进行编译。编译通常要花费几秒到几十秒时间，编译期间，在 VSCode 的左下角可以看到类似 \myblock{\VSCodeCompiling~Build} 的提示信息，编译成功后会显示为 \myblock{\VSCodeCompileSucceed}，如果编译失败则会显示为 \myblock{\VSCodeCompileFailed}。
%
% This project recommends to use VSCode as the editor and compile frontend. You can refer section (\ref{sec:editors}) for the installation and configuration notes of VSCode and a necessary extension \href{https://marketplace.visualstudio.com/items?itemName=James-Yu.latex-workshop}{LaTeX Workshop}. This project provides a well-configured \file{.vscode/settings.json} file.
%
% Use VSCode to open the unzipped folder (Keyboard shortcuts: \myblock{Ctrl k + Ctrl o}); click the \hologo{TeX} icon on the left side panel (needs LaTeX Workshop installed beforehand); expand the \myblock{\myVee~COMMANDS} item and \myblock{\myVee~~$\triangleright$~~Build LaTeX project} item; click the green triangle \myblock{{\color{green}$\triangleright$}} in the \myblock{{\color{green}$\triangleright$} Recipe: build_mythesis} to compile the thesis. Usually it takes several second to a few tens of seconds to complete one compilation. During the compilation, you will see a label like \myblock{\VSCodeCompiling~Build} on the bottom left of the VSCode window. After a successful compilation, it will become \myblock{\VSCodeCompileSucceed}, but if the compilation fails, it will become \myblock{\VSCodeCompileFailed}.
%
% \vspace*{2\baselineskip}
%
% 本项目还提供了几种其它编译方式，供开发者或有其它偏好的用户使用。
%
% \subsubsection{latexmk}
% \begin{ctexexam}
%   latexmk
%   latexmk -c
% \end{ctexexam}
%
% \subsubsection{\hologo{XeLaTeX}}
% \begin{ctexexam}
%   xelatex mythesis.tex
%   biber mythesis
%   xelatex mythesis.tex
%   xelatex mythesis.tex
% \end{ctexexam}
%
% \clearpage
%
% \section{撰写论文 Compose thesis}\label{sec:intro2thesis}
%
% \subsection{文件结构 File structure}
%
% 论文文件夹结构应如表 (\ref{tab:fileStruture}) 所示。其中 \file{figures/} 文件夹请自行按需创建。
%
% The thesis folder should have the following files as listed in Table (\ref{tab:fileStruture}). If the \file{figures/} folder does not exist, please create it by yourself.
%
% \begin{table}[ht]
%   \caption{\cls{hkustthesis}文件结构 file structure}
%   \label{tab:fileStruture}
%   \centering
%   \begin{tabular}{lll}
%     \toprule
%     文件名 file name                      & 功能               & role     \\
%     \midrule
%     \file{.vscode/}                       & VSCode 配置文件夹   & VSCode config folder \\
%     \color{hkustgold}\file{chapters/}     & 存放论文各章节      & storing chapter files for thesis  \\
%     \color{hkustgold}\file{figures/}      & 存放论文所用图片     & storing figure files for thesis \\
%     \file{hkustthesis.cls}                & 模板文档类          & class file   \\
%     \file{latexmkrc}                      & latexmk 配置文件    & latexmkrc config file   \\
%     \file{LICENSE}                        & 许可证              & LICENSE file   \\
%     \color{hkustgold}\file{mythesis.bib}  & 论文所用参考文献 & reference database (\file{.bib} file)\\
%     \color{hkustgold}\file{mythesis.tex}  & 论文\textbf{主文件} & \textbf{main} tex file          \\
%     \file{README.md}                      & 自述文件            & notes \\
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% 对于使用本模板撰写毕业论文的用户，只需要修改表 (\ref{tab:fileStruture}) 中\textcolor{hkustgold}{金色}的文件（夹）。
%
% For users using this template to compose thesis, they only need to edit the files (or folders) marked with \textcolor{hkustgold}{gold} color in Table (\ref{tab:fileStruture}).
%
% \subsection{主文件介绍 Introduction to main tex file}
% \file{mythesis.tex}是本模板的 \hologo{TeX} 主文件。下面将给出主文件内容的解释。
%
% \file{mythesis.tex} is the main tex file for the whole thesis. Here comes the details of this main file.
%
% \subsubsection{文档选项 Document options}
% 文档选项是 \verb|\documentclass[]{hkustthesis}| 中方括号 \verb|[]| 内的选项。
% 本模板定义了如下的文档选项：
%
% Document options are the options specified in the square brackets \verb|[]| in \verb|\documentclass[]{hkustthesis}|. This template defines the following document options.
%
% \begin{function}{customlatinfont}
%  \begin{syntax}
%   customlatinfont = <windows|macos|gyre|none>
%  \end{syntax}
% 自定义西文字体。Customize latin fonts.
% \end{function}
% 该选项默认被 \verb|%| 注释掉，使模板可以在不同平台上自动选择对应的字体 (不同选项使用的字体如表 (\ref{tab:latinfontset}) 所示)。
% 如果用户希望该模板在所有平台上都使用同样的字体（前提是所用字体存在），可以取消该行注释并修改为希望使用的选项。
% 如果用户希望完全由自己设定字体，则可以填 \opt{none}，再通过 \pkg{fontspec} 宏包手动设置字体。
%
% This option is commented by default to allow the template choose corresponding fonts on different platforms (listed in Table (\ref{tab:latinfontset})). If users want to keep the same font sets on all the platforms (the fonts should exist on that platform), they can uncomment this option and set it to one option. If users want to customize the font sets manually, they should set it to \opt{none} and then set the fonts via \pkg{fontspec}.
% \begin{table}[htbp]
%   \centering
%   \caption{西文字体清单}
%   \label{tab:latinfontset}
%   \begin{tabular}{llll}
%     \toprule
%     选项 option     & 衬线体 serif & 无衬线体 sans-serif & 等宽字体 mono \\
%     \midrule
%     windows  & Times~New~Roman           & Arial                   & Courier~New \\
%     macos    & Times~New~Roman           & Arial                   & Menlo \\
%     gyre     & \Hologo{TeX}~Gyre~Termes  & \Hologo{TeX}~Gyre~Heros & \Hologo{TeX}~Gyre~Cursor \\
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% \begin{function}{custombibstyle}
%  \begin{syntax}
%   custombibstyle = <(ieee)|nature|science|apa|mla|phys|chem-acs|nejm>
%  \end{syntax}
% 自定义参考文献条目样式。Customize bibliography style.
% \end{function}
% 该选项默认被 \verb|%| 注释掉。\opt{ieee} 为默认样式。如果想使用列出的其它样式，可以取消注释并修改其值为想使用的样式名，如\opt{nature}。如果希望使用的样式不在此列表，可以阅读 \pkg{biblatex} 的文档并自行修改模板代码。详见第\ref{sec:pkg:biblatex}节处。
%
% This option is commented by default. \opt{ieee} is the default style. If you want to use another style in this list, please uncomment this line and change the value to the style that you want to use, for example, \opt{nature}. If users want to use another style not in this list, they can modify the \file{.dtx} source code with the help of \pkg{biblatex}. You can refer to section \ref{sec:pkg:biblatex} for developing details.
%
% \begin{function}{displaycommittee}\label{opt:displaycommittee}
%  \begin{syntax}
%   displaycommittee = <(false)|true>
%  \end{syntax}
% 设置是否在签名页显示答辩委员会成员列表。Choose whether to display the thesis examination committee (TEC) members.
% \end{function}
% 该选项默认值 \verb|false|，因为 RPG Handbook 提供的示例签名页没有要求列出答辩委员会成员。
% 但某些院系 (如 ECE) 要求在签名页显示答辩委员会成员列表，则需要设置为 \verb|true|，以及需要在下文提及的 \opt{reviewer}、\opt{reviewerdept} 和 \opt{reviewerext} 选项中填写委员会成员信息。
%
% This option is default to \verb|false| as RPG Handbook doesn't require the student to list the TEC members. However, in some departments, like ECE, it is required to list the TEC members. In this case, this option should be uncommented and the items \opt{reviewer}, \opt{reviewerdept} and \opt{reviewerext} should also be filled.
%
% \begin{function}[added=2023-12-01]{blankpage}
%  \begin{syntax}
%   blankpage = <(true)|false>
%  \end{syntax}
% 设置是否插入空白页以确保章节标题位于奇数页。Choose whether to insert blank pages to make sure the title pages of chapters are always located on odd pages.
% \end{function}
% RPG Handbook 要求章节 (Chapter) 标题应当位于新的一页；兼顾打印版本的美观，该选项默认开启，使得章节标题确保处于奇数页。但是在撰写论文的过程中，太多空白页不便于查看，因此可以设置为 \verb|false| 以便自己预览。用户可以自行决定该选项的值。
%
% RPG Handbook requires the title page of chapters should start from a newpage; meanwhile, it is a common practice that all the title pages starts from odd pages for the convenience of printed copies. However, during thesis composing stage, it might be annoying to have many blank pages; so this option can be set to \verb|false| to disable the blank pages.
%
% \subsubsection{论文信息 Thesis information}
%
% \begin{function}{\hkustsetup}
%  \begin{syntax}
%   \tn{hkustsetup}\Arg{键值列表 key value list}
%  \end{syntax}
% 论文必要信息。
% \end{function}
% 此选项的内容是以英文逗号 \verb|,| 分隔的键值列表，定义了该论文的必要信息。每一项等号左边为变量名，右边为由花括号 \verb|{}| 包裹的变量值。其中标为\myoptional{蓝色的选项}为可选填项。如果某一项的值不需要填，可以留空，但花括号 \verb|{}| 仍需要保留。同理，标为\myoptional{蓝色的文字}为可选阅读项，只有填写可选项的用户才需要阅读。
%
% This option is a key value list separated by comma \verb|,| encapsulated with curly brackets \verb|{}| to define necessary information for the thesis. The items marked with \myoptional{blue} are optional. If one term is not necessarily to be filled, you can delete the inner content but keep the curly brackets \verb|{}|.
%
% \begin{function}{degree}
%  \begin{syntax}
%   degree              = \Arg{phd|mphil}
%  \end{syntax}
% \end{function}
% \noindent 学位。仅可以选择\opt{phd}或\opt{mphil}，且不可使用大写字母。\\
% Degree. Please choose one between \opt{phd} and \opt{mphil}, and avoid using upper cases.
%
% \begin{function}{title}
%  \begin{syntax}
%   title               = \Arg{论文标题 Thesis Title}
%  \end{syntax}
% \end{function}
% \noindent 论文标题。其中 \verb|\\| 用于换行，如不需要可以删去。\\
% Thesis title. The \verb|\\| is for line break; you can delete it if not necessary.
%
% \begin{function}{keywords}
%  \begin{syntax}
%   \myoptional{keywords}            = \Arg{关键词 keywords}
%  \end{syntax}
% \end{function}
% \noindent 关键词列表。关键词列表以英文逗号分隔。\\
% Keywords, separated by comma.
%
% \begin{function}{author, school, department, program, major}
%  \begin{syntax}
%   author              = \Arg{作者 author}
%   \myoptional{school}              = \Arg{学院 school}
%   department          = \Arg{系/部门 department or division}
%   program             = \Arg{项目名称 program name}
%   \myoptional{major}               = \Arg{专业 major name}
%  \end{syntax}
% \end{function}
% \noindent 作者。author.\\
% 学院信息。School information, like ``School of Engineering''。\\
% 系/部门的全名。The full name of department or division, like ``Department/Division of XXX''。\\
% 项目名称。Please refer to SIS: ``name of program''。通常和系/部门同名。Usually it is the same as the department name.\\
% 专业方向。Please refer to SIS: ``major''.
%
% \begin{function}{supervisor, co-supervisor}
%  \begin{syntax}
%   supervisor          = \Arg{导师 头衔 姓名 supervisor title and name}
%   co-supervisor       = \Arg{联培导师 头衔 姓名 co-supervisor titl and name}
%  \end{syntax}
% 导师信息。需填写为 ``Prof. XXX''。如无Co-supervisor，可以留空，但保留\verb|{}|。\\
% supervisor information. You need to input the full title and name of supervisors, like ``Prof. XXX''. Keep the \verb|{}| if there is no co-supervisor.
% \end{function}
%
% \begin{function}{submit-month, submit-date, defend-date}
%  \begin{syntax}
%   submit-month        = \Arg{论文提交年月 submit month}
%   submit-date         = \Arg{论文提交日期 submit date}
%   defend-date         = \Arg{论文答辩日期 defend date}
%  \end{syntax}
% \end{function}
% \noindent 提交时间和答辩时间。其中，\opt{submit-month} 请只填写 ``月~年''，而 \opt{submit-date} 和 \opt{defend-date} 请填写 ``日~月~年''。\\
% submit and defend time. For \opt{submit-month}, please input ``month~year''; for \opt{submit-date} and \opt{defend-date}, please input ``date~month~year''.
%
% \begin{function}{depthead}
%  \begin{syntax}
%   depthead            = \Arg{系/部门主任 department head}
%  \end{syntax}
% \end{function}
% \noindent 系头。需填写完整信息，如``Prof. XXX, Head of Department/Division''。\\
% Head. Full information, like ``Prof. XXX, Head of Department/Division''.
% 
% \begin{function}{reviewer, reviewerdept, reviewerext}
%  \begin{syntax}
%   \myoptional{reviewer}            = \Arg{答辩委员会成员 TEC members}
%   \myoptional{reviewerdept}        = \Arg{答辩委员会成员所属机构 TEC members affiliation}
%   \myoptional{reviewerext}         = \Arg{答辩委员会外部成员 TEC external member}
%  \end{syntax}
% \end{function}
% \noindent \myoptional{答辩委员会 (TEC) 信息}：
%
% 某些系要求在签名页列出TEC成员列表，则需要修改上文 (\ref{opt:displaycommittee}处) 提及的 \opt{displaycommittee} 选项为 \verb|true|，并填写 \opt{reviewer}、\opt{reviewerdept}项，PhD 还需填写 \opt{reviewerext}项。一般地，MPhil的TEC需要4名成员，PhD的TEC需要6名成员 (含1名外部成员)。可按需增删此处的内容。实测最大支持7名成员。
%
% \myoptional{\textbf{注意：}} \opt{reviewer} 和 \opt{reviewerdept} 中的每个条目之间需要使用英文逗号分隔；但如果某一条目的部分内容里包含英文逗号，比如 \opt{reviewerext} 中的外部大学名称，则需要用花括号将那一整个部分包裹，否则 \hologo{LaTeX} 程序会在逗号处截断，将其当作两个条目。详见下文给出的示例中的 \opt{reviewerext} 的写法。
%
% \myoptional{\textbf{注意：}} 如果填写PhD的TEC内容，其中 ``External Examiner'' 的所属机构中的 ``Department'' 和 ``University'' 之间的换行符 \verb|\\| 不能删去，否则会使得对齐出错。如果确实没有第二行内容，可以在 \verb|\\| 后使用 \verb|\phantom{xxx}| 作为占位 (这个命令会占据与 \verb|xxx| 同样大小的空间但不实际显示)。
%
% \noindent \myoptional{Thesis Examination Committee (TEC) information}:
%
% Some departments requires to list the TEC members on the signature page; then the users need to change the document option \opt{displaycommittee} to be \verb|true|, and input the information for \opt{reviewer}, \opt{reviewerdept} and \opt{reviewerext} (only for PhD). Usually, the TEC for MPhil includes 4 members and that for PhD includes 6 members including on external member. Users can add or delete the members line here and the maximum supported number is 7.
%
% \myoptional{\textbf{Note:}} Each item in \opt{reviewer} and \opt{reviewerdept} should be separated by comma \verb|,|; but if some items have comma in themselves, then this item should be encapsulated in an extra pair of curly brackets, otherwise \hologo{LaTeX} will truncate the text at the location of that comma. You can refer to the \opt{reviewerext} in the example given below.
%
% \myoptional{\textbf{Note:}} For PhD inputting the ``External Examiner'', the line break mark \verb|\\| in between ``Department'' and ``University'' must be kept, otherwise it will cause some alignment problem. If there is indeed no content for the second line, please use \verb|\phantom{xxx}| as the placeholder.
%
% \begin{function}{city}
%  \begin{syntax}
%   city                = \Arg{地点 location}
%  \end{syntax}
% \end{function}
% \noindent 城市。通常为 ``Hong Kong''。City. Usually it is ``Hong Kong''.
%
% \vspace*{1\baselineskip}
%
% 示例如下。An example is given below.
%
% \begin{ctexexam}
%   \hkustsetup {
%     info = {
%       degree        = {phd},
%       title         = {Triggering\\the Forth Impact},
%       keywords      = {Neon, Genesis, Evangelion},
%       author        = {Cruel Angel},
%       school        = {School of SEELE},
%       department    = {Department of NERV},
%       program       = {Human Instrumentality},
%       major         = {},
%       supervisor    = {Prof. Adams},
%       co-supervisor = {Prof. Lilith},
%       submit-month  = {August 2021},
%       submit-date   = {13 August 2021},
%       defend-date   = {8 March 2021},
%       depthead      = {Prof. Ikari Yui, Head of Department},
%       reviewer      = {Prof. AAA (Chairperson), 
%                       Prof. BBB (Supervisor),
%                       Prof. CCC (Co-supervisor),
%                       Prof. DDD,
%                       Prof. EEE},
%       reviewerdept  = {Department of Electronic and Computer Engineering,
%                       Department of ECE,
%                       Department of ECE,
%                       Department of ECE,
%                       Department of Physics},
%       reviewerext   = {Prof. FFF (External Examiner),
%                        Department of EE\\{University of UU, at VV}},
%       city          = {Geo Front},
%     }
%   }
% \end{ctexexam}
%
% \subsubsection{导言区剩余部分 remaining parts in preamble}
% \begin{itemize}
%  \item 用户可以自行添加所需的宏包、设置和其它命令。
%  \item \verb|\addbibresource{mythesis.bib}| 导入了存放引用文献的 bib 文件。
% \end{itemize}
%
% \begin{itemize}
%  \item Users can add necessary packages, define settings and commands by themselves.
%  \item \verb|\addbibresource{mythesis.bib}| imports the \file{.bib} file for storing the citation database.
% \end{itemize}
%
% \myoptional{\textbf{注意：}} 本模板使用 \pkg{unicode-math} 设置数学环境字体，请不要使用会与之产生冲突的 \pkg{bm} 宏包，否则会报错。事实上，在 \hologo{XeTeX} 引擎下，\pkg{bm} 已经过时。对于 \pkg{bm} 宏包中的常用命令 \verb|\bm|，本模板已经设置了一个别名，用户可以在正文中直接使用 \verb|\bm|。除此之外，如果还有需要使用的 \pkg{bm} 宏包中的命令，请自行设置别名。
%
% \myoptional{\textbf{Note: }} This template uses \pkg{unicode-math} to configure the math fonts. Please avoid using the \pkg{bm} package which is actually outdated under \hologo{XeTeX} engine. For commonly-used \verb|\bm| command in \pkg{bm} package, this template has defined an alias for it. You can define your preferred alias if necessary.
%
% \subsection{正文各章节 chapters in main text}
% 正文区按顺序定义或插入了组成论文的各个组件、章节；用户在 \file{chapters/} 文件夹下修改或新增章节文件后，需要检查主文件中对应的部分是否正确。
% 这样设置文件结构的优点是使得主文件结构清晰可见、各章节便于修改；但如果用户有自己的喜好，也不必拘泥于本模板提供的结构，可以自由发挥。
%
% 在 \verb|\mainmatter| 之后的内容是以章节的形式呈现的论文正文和附录部分，一般以 Introduction、Chapters、Conclusions、 References 和 Appendix 的顺序组织文字。用户可以根据自己的实际情况修改、增加、删除、重命名对应的章节文件，并确保主文件中使用 \verb|\input{}| 的部分
% \begin{ctexexam}
%   \input{chapters/Introduction.tex}
%   \input{chapters/...}
%   \input{chapters/Conclusions.tex}
%   \printbibliography[heading=bibintoc,title=References]
%   \appendix
%   \input{chapters/Appendix_xxx.tex}
% \end{ctexexam}
% 与之对应。
%
% \myoptional{\textbf{注意：}} \file{mythesis.tex} 文件所在的目录是编译时的根目录，因此即使在 \file{chapters/xxx.tex} 文件中插入图片，也应该使用 \verb|{figures/xxx.png}| 而非 \verb|{../figures/xxx.png}| 作为图片的路径。
%
% \file{mythesis.tex} 文件和 \file{chapters} 文件夹内的文件给出了一些示例，用户可以基于这些文件撰写自己的毕业论文。其中部分章节文件内的 \verb|\blindtext| 命令用来生成一段用于测试排版效果的 ``乱数假文'' (lorem ipsum)，正式撰写论文时请将其删去。
%
% The main text (main matter) defines or inserts every important part, including Introduction, Chapters, Conclusions, References and Appendices, for the thesis in order. Users may modify the \file{chapters/} and \file{figures/} folders and update the main tex file to ensure the chapters are in accordance with the \verb|\input{}| parts in the main tex file, as shown in the above example.
%
% \myoptional{\textbf{Note: }} The path of the \file{mythesis.tex} file is the root path for \hologo{LaTeX} compiler. Therefore, all the paths involved in any chapters should be based on the root path of the \file{mythesis.tex} file. In the template files, there are some ``lorem ipsum'' generated by \verb|\blindtext| to test the typesetting results. Please remember to delete these text when composing your thesis.
%
% \vfill
%
% \textbf{以下内容供开发者参考。普通用户无需阅读，可以开始撰写毕业论文了！}
%
% \textbf{The following parts are for developers. General users don't need to read them. You can start composing you thesis!}
%
% \end{documentation}
%
% \newpage
% \thispagestyle{empty}
% \ 
% \cleardoublepage
%
% \begin{implementation}
%
% \section{实现 Implementation}\label{sec:implementation}
%
% \textbf{以下内容供开发者参考。普通用户无需阅读，可以开始撰写毕业论文了！}
%
% \textbf{The following parts are for developers. General users don't need to read them. You can start composing you thesis!}
%
% \vspace*{1\baselineskip}
%
% \verb|@@| 在 \pkg{l3docstrip} 中表示名空间，在删除注释生成格式文件时会被等号后的字段替换，如在本模板\pkg{hkustthesis}中 |@@=hkust|。
% 尖括号包裹的|<*class>||</class>|用来指定某段代码属于哪个文件。
%
%    \begin{macrocode}
%<@@=hkust>
%<*class>
%    \end{macrocode}
%
% \subsection{Known issues \& TODO}
%
% About \verb|x| to \verb|e| type (currently only for dtx):
%
% See \url{https://github.com/CTeX-org/ctex-kit/pull/678}.
%
% This issue happens on \hologo{MiKTeX} 23.10. My temporary solution is to modify the \file{ctxdoc.cls} file in \pkg{ctex} package: change the \verb|x| to \verb|e| and also the \verb|Non| to \verb|Nnn|.
%
% \subsection{定义常量}
%
% \begin{macro}{\@@_define_name:nn}
%
% 用来定义默认名称的辅助函数。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_define_name:nn #1#2
  { \tl_const:cn { c_@@_name_ #1 _tl } {#2} }
%    \end{macrocode}
% \end{macro}
%
% 默认名称。注意空格是忽略掉的。
%    \begin{macrocode}
\clist_map_inline:nn
  { { pdf_creator } { LaTeX~with~hkustthesis~class }, }
  { \@@_define_name:nn #1 }
\clist_map_inline:nn
  { { keywords } { Keywords:~ }, }
  { \@@_define_name:nn #1 }
%    \end{macrocode}
%
% \subsection{模板选项}
%
% 用于配置模板选项的宏包。
%    \begin{macrocode}
\RequirePackage{xparse,xtemplate,l3keys2e}
%    \end{macrocode}
%
% \begin{variable}{\l_@@_info_degree_tl}
% 用于存储学位名称的变量，注意宏的命名，\verb|l|代表局部变量，\verb|g|代表全局变量。
%    \begin{macrocode}
\tl_new:N \l_@@_info_degree_tl
%    \end{macrocode}
% \end{variable}
%
% \begin{variable}{\g_@@_latin_fontset_tl, \g_@@_bib_style_tl}
% 用于存储所用字体名称和参考文献样式的全局变量。
%    \begin{macrocode}
\tl_new:N \g_@@_latin_fontset_tl
\tl_new:N \g_@@_bib_style_tl
\tl_new:N \g_@@_disp_committee_tl
\tl_new:N \g_@@_blankpage_tl
%    \end{macrocode}
% \end{variable}
%
% 学位信息的设置。
%    \begin{macrocode}
\keys_define:nn { hkust }
{
%    \end{macrocode}
%
% \begin{macro}{customlatinfont}
% 定义字体选项。
%    \begin{macrocode}
  customlatinfont   .choices:nn   =
  { gyre, macos, windows, none }
  { \tl_set_eq:NN \g_@@_latin_fontset_tl \l_keys_choice_tl },  
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{custombibstyle}
% 定义参考文献样式。
%    \begin{macrocode}
  custombibstyle    .choices:nn   =
  { ieee, nature, science, apa, mla, phys, chem-acs, nejm }
  { \tl_set_eq:NN \g_@@_bib_style_tl \l_keys_choice_tl },  
  custombibstyle    .initial:n    = ieee,
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{displaycommittee}
% 显示委员会成员列表。
%    \begin{macrocode}
  displaycommittee    .choices:nn   = { true, false }
  { \tl_set_eq:NN \g_@@_disp_committee_tl \l_keys_choice_tl },  
  displaycommittee    .initial:n    = false,
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{blankpage}
% 是否增加空白页以确保章节标题在奇数页开始。
%    \begin{macrocode}
    blankpage    .choices:nn      = { true, false }
    { \tl_set_eq:NN \g_@@_blankpage_tl \l_keys_choice_tl },  
    blankpage    .initial:n       = true,
}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\ProcessKeysOptions}
% 在定义完全部设置以后从tex文件导言区输入参数。
%    \begin{macrocode}
\ProcessKeysOptions { hkust }
%    \end{macrocode}
% \end{macro}
%
% \subsection{论文信息}
% 输入论文的必要信息。
%    \begin{macrocode}
\keys_define:nn { hkust }
{ info               .meta:nn = { hkust / info } { #1 } }
%    \end{macrocode}
%
%    \begin{macrocode}
\keys_define:nn { hkust / info }
{
%    \end{macrocode}
%
% \begin{macro}{info/degree}
%    \begin{macrocode}
  degree            .tl_set:N = \l_@@_info_degree_tl,
%    \end{macrocode}
% \end{macro}
% 学位名称：phd 或 mphil。
%
% \begin{macro}{info/title}
%    \begin{macrocode}
  title             .tl_set:N = \l_@@_info_title_tl,
%    \end{macrocode}
% \end{macro}
% 论文标题。经测试，本模板最大支持3行标题，如果多于3行，有部分情况会出现溢出页面的问题。
%
% \begin{macro}{info/keywords}
%    \begin{macrocode}
keywords         .clist_set:N = \l_@@_info_keywords_clist,
%    \end{macrocode}
% \end{macro}
% 关键词。
% 
% \begin{macro}{info/author,info/school,info/department,info/program,info/major}
%    \begin{macrocode}
  author            .tl_set:N = \l_@@_info_author_tl,
  school            .tl_set:N = \l_@@_info_school_tl,
  department        .tl_set:N = \l_@@_info_department_tl,
  program           .tl_set:N = \l_@@_name_of_program_tl,
  major             .tl_set:N = \l_@@_major_tl,
%    \end{macrocode}
% \end{macro}
% 作者、学院、系/部门、项目、专业。
%  
% \begin{macro}{info/supervisor,info/co-supervisor}
%    \begin{macrocode}
  supervisor        .tl_set:N = \l_@@_info_supervisor_tl,
  co-supervisor     .tl_set:N = \l_@@_info_co_supervisor_tl,
%    \end{macrocode}
% \end{macro}
% 导师。
%
% \begin{macro}{info/submit-month,info/submit-date,info/defend-date,info/depthead,info/reviewer,info/reviewerdept,info/reviewerext,info/city}
%    \begin{macrocode}
  submit-month      .tl_set:N = \l_@@_submit_month_tl,
  submit-date       .tl_set:N = \l_@@_submit_date_tl,
  defend-date       .tl_set:N = \l_@@_defend_date_tl,
  depthead          .tl_set:N = \l_@@_info_depthead_tl,
  reviewer       .clist_set:N = \l_@@_info_reviewer_clist,
  reviewerdept   .clist_set:N = \l_@@_info_reviewer_dept_clist,
  reviewerext    .clist_set:N = \l_@@_info_reviewer_ext_clist,
  city              .tl_set:N = \l_@@_info_city_tl,
}
%    \end{macrocode}
% \end{macro}
% 提交和答辩。
%
% \begin{macro}{\hkustsetup}
% 定义用于设置个人信息的命令。
%    \begin{macrocode}
\NewDocumentCommand \hkustsetup { m }
{ \keys_set:nn { hkust } { #1 } }
%    \end{macrocode}
% \end{macro}
%
% \subsection{载入文档类}
% 
% 使用\pkg{book}文档类。
%    \begin{macrocode}
\str_if_eq:NNTF { \g_@@_blankpage_tl } { true }
{
    \PassOptionsToClass{a4paper,12pt,UTF8,twoside}{book}
}{
    \PassOptionsToClass{a4paper,12pt,UTF8,oneside}{book}
}
\LoadClass{book}
%    \end{macrocode}
%
% \subsection{载入宏包}
%
% 载入各种宏包。
% \pkg{emptypage}用于清除空白页的页码。
%    \begin{macrocode}
\RequirePackage
{
  geometry,
  caption,
  float,
  setspace,
  lastpage,
  emptypage,
  fancyhdr,
  makecell
}
%    \end{macrocode}
%
% 此处为行距设置，FYTGS的邮件确认是 Word 中的 1.5 倍行距。\\
% 关于行距，12pt的 Times~New~Roman 文字在Word里的单倍行距对应的 PDF 行距是1.15，1.5倍 Word 行距对应的 PDF 行距是1.72；而在 \hologo{LaTeX} 中设置 linespread = 1 时生成的 PDF 的行距是 1.2。所以要想得到 1.5 倍 Word 行距 (即 1.72 倍 PDF 行距)，需要设置的 linespread 为：
% \[ \frac{1.72}{1.2} = 1.433\]
% 而由于单倍行距在 Word 和 \hologo{LaTeX}生成的PDF 中差别很小，故使用了 \verb|\singlespacing| 命令实现。
%    \begin{macrocode}
\linespread{1.43}
%^^A \onehalfspacing
%^^A \setstretch{1.5}
%^^A \setlength{\baselineskip}{18pt}
%    \end{macrocode}
%
% 标题、目录和链接。
%    \begin{macrocode}
\RequirePackage[explicit]{titlesec} % typesetting titles of chap/sec/...
\RequirePackage[titles]{tocloft}
\RequirePackage[hyphens]{url} % generate better linebreaks in the url
%    \end{macrocode}
%
% 用于特定学科的包。
%    \begin{macrocode}
\RequirePackage{siunitx}            % 用于书写单位符号
\RequirePackage[version=4]{mhchem}  % 用于绘制分子式
\RequirePackage{physics}            % Physics package
\AtBeginDocument{\RenewCommandCopy\qty\SI}
\RequirePackage{braket}             % for Dirac notation
%    \end{macrocode}
%
% 用于生成可以被插入书签的LaTeX logo。
%    \begin{macrocode}
\RequirePackage{hologo} 
%    \end{macrocode}
%
%    \begin{macrocode}
% \RequirePackage{needspace} % prevent page break after sectioning
% \RequirePackage{xspace} % Better print trailing whitespace
%    \end{macrocode}
%
% \pkg{amsmath}必须在\pkg{unicode-math}前加载。
% \pkg{unicode-math}指定了\hologo{XeTeX}和\hologo{LuaTeX}下所使用的数学字体。
% 用于配置数学环境的\pkg{mathtools}会与\pkg{unicode-math}发生冲突，此处手动消除其警告。
%    \begin{macrocode}
\RequirePackage{amsmath,amsthm,mathtools,thmtools}
\RequirePackage[
  warnings-off={mathtools-colon,mathtools-overbracket}
]{unicode-math}
%    \end{macrocode}
%
% 配置图片、表格、代码、列表环境。
%    \begin{macrocode}
\RequirePackage{graphicx,subcaption,wrapfig,tikz}
\DeclareGraphicsExtensions{.pdf,.eps,.jpg,.png}
\RequirePackage{booktabs,multirow,multicol,listings,algorithm,algorithmic,enumitem}
%    \end{macrocode}
%
% 必须以该顺序加载以下两个关于引用的包。
%    \begin{macrocode}
\RequirePackage[
  hidelinks,
  bookmarksnumbered = true,
  psdextra          = true,
  unicode           = true,
  colorlinks        = true,
  linkcolor         = black,
  urlcolor          = blue,
  citecolor         = red,
  anchorcolor       = blue,
  ]{hyperref}
\RequirePackage[capitalise,nameinlink,noabbrev]{cleveref}
%    \end{macrocode}
%
% 生成 ``Lorem ipsum'' 测试文字。
%    \begin{macrocode}
\RequirePackage{blindtext} 
%    \end{macrocode}
%
% \subsection{字体设置}
%
% 导入 \pkg{fontspec} 宏包。
%    \begin{macrocode}
\RequirePackage{fontspec} 
%    \end{macrocode}
%
% \subsubsection{操作系统检测}
%
% \begin{variable}{\g_@@_load_system_fontset_bool}
% 定义用于判断是否需要载入系统预装字体的变量。
%    \begin{macrocode}
\bool_new:N \g_@@_load_system_fontset_bool
%    \end{macrocode}
% \end{variable}
%
% 判断用户是否自定义了英文字体。如果未定义，则使用系统预装字体覆盖字体选项。
%    \begin{macrocode}
\tl_if_empty:NTF \g_@@_latin_fontset_tl
  { \bool_gset_true:N \g_@@_load_system_fontset_bool }  
  { }
%    \end{macrocode}
%
% 进行系统检测。
% 检测 Windows 的命令由\pkg{l3kernal}提供，
% 检测 macOS 的命令 modified from \pkg{ctex}，
% 以特定字体判断 macOS 系统。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_if_platform_macos:TF
  { \file_if_exist:nTF { /System/Library/Fonts/Menlo.ttc } }
%    \end{macrocode}
%
% 这两种情况外的系统被判断为 Linux，一律使用自由字体。
%    \begin{macrocode}
\bool_if:NT \g_@@_load_system_fontset_bool
{
  \sys_if_platform_windows:TF
  { \tl_set:Nn \g_@@_latin_fontset_tl { windows } }
  {
    \@@_if_platform_macos:TF
    { \tl_set:Nn \g_@@_latin_fontset_tl { macos } }
    { \tl_set:Nn \g_@@_latin_fontset_tl { gyre  } }
  }
}
%    \end{macrocode}
%
% \subsubsection{定义英文字库}
%
% 接下来逐个定义所需要使用的字库。
%
% \begin{macro}{\@@_load_latin_font_windows:}
% Windows 西文字体。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_load_latin_font_windows:
{
  \setmainfont{Times~New~Roman}
  \setsansfont{Arial}
  \setmonofont{Courier~New}[Scale=MatchLowercase]
}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_load_latin_font_macos:}
% macOS 西文字体。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_load_latin_font_macos:
{
  \setmainfont{Times~New~Roman}
  \setsansfont{Arial}
  \setmonofont{Menlo}[Scale=MatchLowercase]
}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@@_load_latin_font_gyre:}
% 开源的 gyre 西文字体。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_load_latin_font_gyre:
{
  \setmainfont{texgyretermes}[
    Extension=.otf,
    UprightFont=*-regular,
    BoldFont=*-bold,
    ItalicFont=*-italic,
    BoldItalicFont=*-bolditalic]
  \setsansfont{texgyreheros}[
    Extension=.otf,
    UprightFont=*-regular,
    BoldFont=*-bold,
    ItalicFont=*-italic,
    BoldItalicFont=*-bolditalic]
  \setmonofont{texgyrecursor}[
    Extension=.otf,
    UprightFont=*-regular,
    BoldFont=*-bold,
    ItalicFont=*-italic,
    BoldItalicFont=*-bolditalic,
    Scale=MatchLowercase,
    Ligatures=CommonOff]
}
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{载入指定字库}
%
% 载入字体命令。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_load_font:
{ \use:c { @@_load_latin_font_ \g_@@_latin_fontset_tl : } }
%    \end{macrocode}
%
% 载入设置的字体。
%    \begin{macrocode}
\@@_load_font:
%    \end{macrocode}
%
% 设置数学字体 (XITS, 或者 \href{https://www.stixfonts.org}{STIX}, 与 Times New Roman 最为相近)。
%    \begin{macrocode}
% \setmathfont{STIXTwoMath-Regular}[Extension = .otf]
\setmathfont{XITSMath-Regular}[
  BoldFont = XITSMath-Bold,
  Extension = .otf]
\setmathfont{latinmodern-math.otf}[range={cal,bb,frak}]
%    \end{macrocode}
%
% \subsection{页面布局}
%
% \subsubsection{页边距}
%
% 使用\pkg{geometry}设置页边距。
%    \begin{macrocode}
\geometry{vmargin = 2.5 cm, hmargin = 2.5 cm}
%    \end{macrocode}
%
% \subsubsection{页眉页脚}
% 
%    \begin{macrocode}
\fancypagestyle{hkustplain}{
   \fancyhead{}               
   \fancyfoot[C]{\thepage}
}
%    \end{macrocode}
%
% 载入页眉页脚设置。此处\tn{flushbottom}是为了防止目录页出现underfull \tn{vbox}信息。
%    \begin{macrocode}
\tl_set:Nn \headrulewidth {0pt}
\tl_set:Nn \footrulewidth {0pt}
\AtBeginDocument{\pagestyle{hkustplain}\flushbottom}
%    \end{macrocode}
%
% \subsection{章节标题}
% 
% 由\pkg{titlesec}设置。
%    \begin{macrocode}
\titleformat
  {\chapter}
  [display]
  {\centering\onehalfspacing\Large\bfseries\selectfont}
  {\MakeUppercase{\chaptertitlename}~\thechapter}
  {10pt}
  {\MakeUppercase{#1}}
\titlespacing{\chapter}{0pt}{20pt}{20pt}
%    \end{macrocode}
%
% \subsection{目录}
% 使用\pkg{tocloft}定制目录文字格式。
%    \begin{macrocode}
\cftsetpnumwidth{2em}
\renewcommand{\cftchapfont}{\rmfamily\selectfont}
\renewcommand{\cftchappagefont}{\rmfamily\selectfont}
\renewcommand{\cftchapdotsep}{\cftdotsep}
\renewcommand{\cftchapleader}{\cftdotfill{\cftchapdotsep}}
\renewcommand{\cftchappresnum}{Chapter~}
\renewcommand{\cftdot}{}
\setlength{\cftsecindent}{6em}
\setlength{\cftsubsecindent}{8em}
\setlength{\cftchapnumwidth}{6em}
\setlength{\cftsecnumwidth}{2em}
\setlength{\cftsubsecnumwidth}{3em}
\g@addto@macro\appendix{%
  \addtocontents{toc}{%
    \protect\renewcommand{\protect\cftchappresnum}{\appendixname\space}%
  }%
}
%    \end{macrocode}
%
% \begin{macro}{\tableofcontents}
% 重定义目录命令，修改标题格式并插入书签。
%    \begin{macrocode}
\tl_new:N \l_@@_toc_title_text
\tl_set:Nn \l_@@_toc_title_text {Table~of~Contents}
\renewcommand\tableofcontents{%
  \clearpage
  \raggedbottom
  \chapter*{\MakeUppercase{\l_@@_toc_title_text}}%
  \addcontentsline{toc}{chapter}{\l_@@_toc_title_text}
  {\@starttoc{toc}}%
}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\listoffigures}
% 重定义插图目录命令，修改标题格式并插入书签。
%    \begin{macrocode}
\tl_new:N \l_@@_lof_title_text
\tl_set:Nn \l_@@_lof_title_text {List~of~Figures}
\renewcommand{\cftfigpresnum}{Figure~}
\setlength{\cftfignumwidth}{5em}
\renewcommand\listoffigures{%
  \clearpage
  \chapter*{\MakeUppercase{\l_@@_lof_title_text}}%
  \addcontentsline{toc}{chapter}{\l_@@_lof_title_text}
  {\singlespacing\@starttoc{lof}}%
}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\listoftables}
% 重定义表格目录命令，修改标题格式并插入书签。
%    \begin{macrocode}
\tl_new:N \l_@@_lot_title_text
\tl_set:Nn \l_@@_lot_title_text {List~of~Tables}
\renewcommand{\cfttabpresnum}{Table~}
\setlength{\cfttabnumwidth}{5em}
\renewcommand\listoftables{%
  \clearpage
  \chapter*{\MakeUppercase{\l_@@_lot_title_text}}%
  \addcontentsline{toc}{chapter}{\l_@@_lot_title_text}
  {\singlespacing\@starttoc{lot}}%
}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\listofalgorithms}
% 重定义算法目录命令，修改标题格式并插入书签。
% TODO: hack \cmd{\listofalgorithms} to \cmd{listoftables}
% See \url{https://tex.stackexchange.com/questions/263778}
%    \begin{macrocode}
\begingroup
  \let\newcounter\@gobble
  \let\setcounter\@gobbletwo
  \globaldefs\@ne
  \let\c@loadepth\@ne
  \newlistof{algorithms}{loa}{\listalgorithmname}
\endgroup
\let\l@algorithm\l@algorithms
\renewcommand\cftalgorithmsaftersnum{}
\renewcommand\cftalgorithmspresnum{Algorithm~}
\cftsetindents{algorithms}{1.5em}{6em}
\NewDocumentCommand\newlistofalgorithms{}{
  \listofalgorithms
  \addcontentsline{toc}{chapter}{List~of~Algorithms}
}
%    \end{macrocode}
% \end{macro}
%
% \subsection{前言致谢}
% 
% \begin{environment}{preface}
% 单独制作的前言页。
%    \begin{macrocode}
\NewDocumentEnvironment{preface}{}
{%
  \clearpage
  \chapter*{Preface}
  \addcontentsline{toc}{chapter}{Preface}
}{}
%    \end{macrocode}
% \end{environment}
%
% \begin{environment}{acknowledgements}
% 单独制作的致谢页。
%    \begin{macrocode}
\NewDocumentEnvironment{acknowledgements}{}
{%
  \clearpage
  \chapter*{Acknowledgements}
  \addcontentsline{toc}{chapter}{Acknowledgements}
}{}
%    \end{macrocode}
% \end{environment}
%
% \begin{environment}{dedication}
% 单独制作的 dedication 页。
%    \begin{macrocode}
\NewDocumentEnvironment{dedication}{}
{%
  \clearpage
  \phantomsection
  \addcontentsline{toc}{chapter}{Dedication}
  \itshape
  \vspace*{\fill}
  \centering
}{\par
  \vspace*{\fill}
  }
%    \end{macrocode}
% \end{environment}
%%
% \subsection{封面}
%
% \subsubsection{内部命令}
%
% \begin{variable}{\l_@@_name_degree_tl,\l_@@_abbr_degree_tl}
% 用于存储学位名称的变量。
%    \begin{macrocode}
\tl_new:N \l_@@_name_degree_tl
\tl_new:N \l_@@_abbr_degree_tl
%    \end{macrocode}
% \end{variable}
%
% 判断学位进行命令定义。
%    \begin{macrocode}
\msg_new:nnn { hkustthesis }{ unknown-degree }
  { Unknown~ degree:~ \l_@@_info_degree_tl.\\ Please~ check~ spelling.}
\cs_new_protected:Npn \@@_print_degree_name:
{
\str_if_eq:NNTF { \l_@@_info_degree_tl } { phd }
  {
   \tl_set:Nn \l_@@_name_degree_tl { Doctor~of~Philosophy }
   \tl_set:Nn \l_@@_abbr_degree_tl { PhD }
  }
  {
    \str_if_eq:NNTF { \l_@@_info_degree_tl } { mphil }
    {
     \tl_set:Nn \l_@@_name_degree_tl { Master~of~Philosophy }
     \tl_set:Nn \l_@@_abbr_degree_tl { MPhil }
    }
    { \msg_error:nn { hkustthesis } { unknown-degree } }
  }
}
%    \end{macrocode}
%
% \subsubsection{绘制封面}
% 
% \begin{macro}{\@@_print_titlepage:}
% 封面页。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_print_titlepage:
{
  \cleardoublepage
  \thispagestyle{plain}
  \addcontentsline{toc}{chapter}{Title~Page}
  \begin{center}
    \phantom{[SMAPLE~TITLE~PAGE]}\\[1\baselineskip]
    { \LARGE\bfseries\selectfont\l_@@_info_title_tl}
      \\[5\baselineskip]
      by\\[1\baselineskip]
      \l_@@_info_author_tl\\[5\baselineskip]
    {
      A~Thesis~Submitted~to\\
      The~Hong~Kong~University~of~Science~and~Technology\\
      in~Partial~Fulfilment~of~the~Requirements~for\\
      \@@_print_degree_name:
      the~Degree~of~{\l_@@_name_degree_tl}\\
      in~{\l_@@_name_of_program_tl}
    }\\[3\baselineskip]
    \l_@@_submit_month_tl,~\l_@@_info_city_tl\par%
  \end{center}
  \normalfont
  \clearpage
}
%    \end{macrocode}
% \end{macro}
% 
% \begin{macro}{\maketitle}
% 重定义maketitle生成封面。
%    \begin{macrocode}
\tl_set:Nn \maketitle {\@@_print_titlepage:}
%    \end{macrocode}
% \end{macro}
%
% \subsection{摘要}
%
% \begin{macro}{\@@_print_abstract:}
% 输出摘要页。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_print_abstract:
{
  \cleardoublepage
  \thispagestyle{plain}
  \phantomsection
  \addcontentsline{toc}{chapter}{Abstract}
  {
    \begin{center}
    \phantom{[SAMPLE~ABSTRACT~PAGE]}\\[1\baselineskip]
    { \LARGE\bfseries\selectfont\l_@@_info_title_tl}
      \\[1\baselineskip]
      by~\l_@@_info_author_tl \\[2\baselineskip]
      \l_@@_info_department_tl \\[1\baselineskip]
      The~Hong~Kong~University~of~Science~and~Technology\\[2\baselineskip]
      Abstract
    \end{center}
  }
  \singlespacing\selectfont
}
%    \end{macrocode}
% \end{macro}
%
%    \begin{macrocode}
\NewDocumentEnvironment{abstract} {}
{ \@@_print_abstract: }{ \clearpage }
%    \end{macrocode}
%
% \subsection{Authorization}
% \begin{macro}{\@@_print_authorization_g:}
% 输出授权页。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_print_authorization_g:
{
  \cleardoublepage
  \thispagestyle{plain}
  \phantomsection
  \addcontentsline{toc}{chapter}{Authorization}
  {
    {
    \begin{center}
    \phantom{[SAMPLE~AUTHORIZATION~PAGE]}\\
    \large\bfseries\selectfont\underline{Authorization}\\[2\baselineskip]
    \end{center}
    }
    {\setlength{\parindent}{3em}
    I~hereby~declare~that~I~am~the~sole~author~of~the~thesis.\\

    \par I~authorize~the~Hong~Kong~University~of~Science~and~Technology~
    to~lend~this~thesis~to~other~institutions~or~individuals~for~the~
    purpose~of~scholarly~research.\\
    
    \par I~further~authorize~the~Hong~Kong~University~of~Science~and~
    Technology~to~reproduce~the~thesis~by~photocopying~or~by~other~means,~
    in~total~or~in~part,~at~the~request~of~other~institutions~or~
    individuals~for~the~purpose~of~scholarly~research.
    \\[5\baselineskip]
    }
    {
    \begin{center}
    \makebox[3.5in]{\hrulefill}\\
    \l_@@_info_author_tl \\[1\baselineskip]
    \l_@@_submit_date_tl
    \end{center}
    }
 }
}
%    \end{macrocode}
% \end{macro}
%
%    \begin{macrocode}
\NewDocumentCommand\authorization{}
  {\@@_print_authorization_g:\clearpage}
%    \end{macrocode}
%
% \subsection{Signature~Page}
% \begin{macro}{\@@_print_signaturepage_g:}
% 输出签名页。
%    \begin{macrocode}
\cs_new_protected:Npn \@@_print_signaturepage_g:
{
  \cleardoublepage
  \thispagestyle{plain}
  \phantomsection
  \addcontentsline{toc}{chapter}{Signature~Page}
  {
   \str_if_empty:NTF \l_@@_info_co_supervisor_tl
    {
    \begin{center}
      \str_if_eq:NNTF { \g_@@_disp_committee_tl } { true }
      {
      \phantom{SAMPLE~SIGNATURE~PAGE}\\
      \vspace{-20pt}
      {\LARGE\bfseries\selectfont\l_@@_info_title_tl}
       \\[1\baselineskip]
      by \\[1\baselineskip]
      \l_@@_info_author_tl \\[1\baselineskip]
      This~is~to~certify~that~I~have~examined~the~
      \@@_print_degree_name:
      above~{\l_@@_abbr_degree_tl}~thesis\\
      and~have~found~that~it~is~complete~and~satisfactory~in~all~respects,\\
      and~that~any~and~all~revisions~required~by\\
      the~thesis~examination~committee~have~been~made.\\[3\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_supervisor_tl,~Thesis~Supervisor
       \\[3\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_depthead_tl\\[1\baselineskip]
    \end{center}
      \int_new:N \l_@@_reviewer_clist_len_int
      \int_new:N \l_@@_reviewer_index_int
      \int_set:Nn \l_@@_reviewer_clist_len_int
                  {\clist_count:N \l_@@_info_reviewer_clist}
      \int_set:Nn \l_@@_reviewer_index_int {1}
      \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}l}
        Thesis~Examination~Committee & \\
        \int_do_until:nNnn {\l_@@_reviewer_index_int} > 
                           {\l_@@_reviewer_clist_len_int}
        {
          \int_eval:n \l_@@_reviewer_index_int .~ 
          \clist_item:Nn \l_@@_info_reviewer_clist
                         {\l_@@_reviewer_index_int} &
          \clist_item:Nn \l_@@_info_reviewer_dept_clist
                         {\l_@@_reviewer_index_int} \\
          \int_gincr:N \l_@@_reviewer_index_int
        }
        \str_if_empty:NTF {\l_@@_info_reviewer_ext_clist}
        { }
        { \makecell[l]{\int_eval:n {\l_@@_reviewer_clist_len_int + 1} .~ 
                       \clist_item:Nn \l_@@_info_reviewer_ext_clist { 1 } 
                       \\ \phantom{placeholder}} & 
          \makecell[l]{\clist_item:Nn \l_@@_info_reviewer_ext_clist { 2 }} }
      \end{tabular*}
    }
    {
      \phantom{SAMPLE~SIGNATURE~PAGE}\\[1\baselineskip]
      {\LARGE\bfseries\selectfont\l_@@_info_title_tl}
        \\[4\baselineskip]
      by \\[1\baselineskip]
      \l_@@_info_author_tl \\[2\baselineskip]
      This~is~to~certify~that~I~have~examined~the~
      \@@_print_degree_name:
      above~{\l_@@_abbr_degree_tl}~thesis\\
      and~have~found~that~it~is~complete~and~satisfactory~in~all~respects,\\
      and~that~any~and~all~revisions~required~by\\
      the~thesis~examination~committee~have~been~made.\\[4\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_supervisor_tl,~Thesis~Supervisor
       \\[3\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_depthead_tl\\[1\baselineskip]
    \end{center}
    }
    \begin{center}
    \l_@@_info_department_tl \\
    \l_@@_submit_date_tl
    \end{center}
    }
    {
    \begin{center}
      \str_if_eq:NNTF { \g_@@_disp_committee_tl } { true }
      {
      {\LARGE\bfseries\selectfont\l_@@_info_title_tl}
        \\[1\baselineskip]
      by \\[1\baselineskip]
      \l_@@_info_author_tl \\[1\baselineskip]
      This~is~to~certify~that~I~have~examined~the~
      \@@_print_degree_name:
      above~{\l_@@_abbr_degree_tl}~thesis\\
      and~have~found~that~it~is~complete~and~satisfactory~in~all~respects,\\
      and~that~any~and~all~revisions~required~by\\
      the~thesis~examination~committee~have~been~made.\\[2\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_supervisor_tl,~Thesis~Supervisor
       \\[2\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_co_supervisor_tl,~Thesis~Co-supervisor
       \\[2\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_depthead_tl\\[0\baselineskip]
    \end{center}
      \int_new:N \l_@@_reviewer_clist_len_int
      \int_new:N \l_@@_reviewer_index_int
      \int_set:Nn \l_@@_reviewer_clist_len_int
                  {\clist_count:N \l_@@_info_reviewer_clist}
      \int_set:Nn \l_@@_reviewer_index_int {1}
      \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}l}
        Thesis~Examination~Committee & \\
        \int_do_until:nNnn {\l_@@_reviewer_index_int} > 
                           {\l_@@_reviewer_clist_len_int}
        {
          \int_eval:n \l_@@_reviewer_index_int .~ 
          \clist_item:Nn \l_@@_info_reviewer_clist 
                         {\l_@@_reviewer_index_int} &
          \clist_item:Nn \l_@@_info_reviewer_dept_clist
                         {\l_@@_reviewer_index_int} \\
          \int_gincr:N \l_@@_reviewer_index_int
        }
        \str_if_empty:NTF {\l_@@_info_reviewer_ext_clist}
        { }
        { \makecell[l]{\int_eval:n {\l_@@_reviewer_clist_len_int + 1} .~ 
                       \clist_item:Nn \l_@@_info_reviewer_ext_clist { 1 }
                       \\ \phantom{placeholder}} & 
          \makecell[l]{\clist_item:Nn \l_@@_info_reviewer_ext_clist { 2 }} }
      \end{tabular*}
    }
    {
      \phantom{SMAPLE~SIGNATURE~PAGE}\\[1\baselineskip]
      {\LARGE\bfseries\selectfont\l_@@_info_title_tl}
        \\[4\baselineskip]
      by \\[1\baselineskip]
      \l_@@_info_author_tl \\[2\baselineskip]
      This~is~to~certify~that~I~have~examined~the~
      \@@_print_degree_name:
      above~{\l_@@_abbr_degree_tl}~thesis\\
      and~have~found~that~it~is~complete~and~satisfactory~in~all~respects,\\
      and~that~any~and~all~revisions~required~by\\
      the~thesis~examination~committee~have~been~made.\\[2\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_supervisor_tl,~Thesis~Supervisor
       \\[2\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_co_supervisor_tl,~Thesis~Co-supervisor
       \\[2\baselineskip]
      \makebox[3.5in]{\hrulefill}\\
      \l_@@_info_depthead_tl\\[1\baselineskip]
    \end{center}
    }
    \begin{center}
    \l_@@_info_department_tl \\
    \l_@@_submit_date_tl
    \end{center}
    }

  }
}
%    \end{macrocode}
% \end{macro}
%
%    \begin{macrocode}
\NewDocumentCommand\signaturepage{}
  {\@@_print_signaturepage_g:\clearpage}
%    \end{macrocode}
%
% \subsection{参考文献}\label{sec:pkg:biblatex}
% 
% biblatex设置。\\
% TODO: \st{Add an option for bib style.} Done.
%    \begin{macrocode}
\RequirePackage[
    style=\g_@@_bib_style_tl,
    %style=numeric-comp,
    %citestyle=authortitle-icomp,
    citestyle=numeric-comp,
    %bibstyle=authoryear,
    %bibstyle=numeric,
    dashed=false,
    sorting=none,
    %sorting=nyt,
    %sortcites=true,
    %autocite=footnote,
    backend=biber, % Compile the bibliography with biber
    hyperref=true,
    backref=true,
    citecounter=true,
    pagetracker=true,
    citetracker=true,
    ibidtracker=context,
    autopunct=true,
    autocite=plain,
    % gbpub=false,         % Uncomment if you do NOT want '[S.l. : s.n.]' 
                           % in reference entries, GitHub Issue (#47)
    % gbnamefmt=lowercase, % Uncomment if you do NOT want uppercase author 
                           % names in reference entries, GitHub Issue (#23)
]{biblatex}
%    \end{macrocode}
%
% 忽略不需要的文献信息。
%    \begin{macrocode}
\AtEveryBibitem{
    \clearfield{abstract}
    \clearfield{issn}
    \clearfield{isbn}
    \clearfield{archivePrefix}
    \clearfield{arxivId}
    \clearfield{pmid}
    \clearfield{eprint}
    \clearfield{urlyear}
    \clearfield{urlmonth}
    \ifentrytype{online}{}{\ifentrytype{misc}{}{\clearfield{url}}}
    % \ifentrytype{book}{\clearfield{doi}}{}
}
%    \end{macrocode}
%
% \subsection{List~of~Publications}
% \begin{macro}{\paperlist}
% 发表文章列表。\\
% CHANGELOG: Add an optional argument to paperlist for customization.
%    \begin{macrocode}
\NewDocumentCommand\paperlist { o m }
{  
  \begin{refsection} 
    \nocite{#2}
    \printbibliography[heading=subbibliography,title=#1]
  \end{refsection}
}
%    \end{macrocode}
% \end{macro}
%
% \subsection{Cross~Reference}
% 由 \pkg{cref} 实现自动化标签名称。
%    \begin{macrocode}
\crefdefaultlabelformat{(#2#1#3)}
\crefname{figure}{Figure}{Figures}
\crefname{table}{Table}{Tables}
\crefname{equation}{Equation}{Equations}
\crefformat{chapter}{Chapter~#2#1#3}
\crefformat{section}{Section~#2#1#3}
\crefformat{subsection}{Subsection~#2#1#3}
\crefformat{subsubsection}{Subsubsection~#2#1#3}
\crefname{appendix}{Appendix}{Appendices}
\crefname{definition}{Definition}{Definitions}
\crefname{axiom}{axiom}{Axioms}
\crefname{property}{Property}{Properties}
\crefname{proposition}{Proposition}{Propositions}
\crefname{lemma}{Lemma}{Lemmas}
\crefname{corollary}{Corollary}{Corollaries}
\crefname{remark}{Remark}{Remarks}
\crefname{condition}{Condition}{Conditions}
\crefname{conclusion}{Conclusion}{Conclusions}
\crefname{assumption}{Assumption}{Assumptions}
%    \end{macrocode}
%
% CHANGELOG: Get rid of all ctex packages.\\
% \pkg{unicode-math} 与 \pkg{bm} 冲突。定义或重定义一些相关命令以规避后者带来的问题。\\
% 注：实际上，使用 \hologo{XeLaTeX} 时已经不需要使用过时的 \pkg{bm} 宏包。\\
% \pkg{hyperref} 
%    \begin{macrocode}
\cs_new_protected:Npx \@@_gadd_ltxhook:nn #1
  { \hook_gput_code:nnn {#1} { \c_novalue_tl } }
\cs_new_protected:Npn \@@_at_end_preamble:n
  { \@@_gadd_ltxhook:nn { begindocument/before } }
\@@_at_end_preamble:n
{
  \NewDocumentCommand \mathbi {m} {\symbfit{#1}}
  \ProvideDocumentCommand \bm {m} {\mathbi{#1}}
  \RenewDocumentCommand \bm {m} {\mathbi{#1}}
  \hypersetup
    {
      pdftitle    = \l_@@_info_title_tl,
      pdfauthor   = \l_@@_info_author_tl,
      pdfcreator  = \c_@@_name_pdf_creator_tl,
      pdfsubject  = to~her
    }
}
%    \end{macrocode}
%
% \subsection{图表浮动体}
% 
% \subsubsection{图片表格}
%
% 图表标题样式。
%    \begin{macrocode}
\DeclareCaptionFont{capfont}{
  \rmfamily\selectfont
}
\DeclareCaptionStyle{figurecapstyle}{
    font          = normal,
    labelfont     = capfont,
    textfont      = capfont,
    strut         = no,
    hypcap        = true,
    justification = centerfirst
}
\DeclareCaptionStyle{tablecapstyle}{
    font          = normal,
    labelfont     = capfont,
    textfont      = capfont,
    strut         = no,
    hypcap        = true,
    justification = centerfirst
}
\captionsetup[ figure ]{ style = figurecapstyle }
\captionsetup[ table  ]{ style = tablecapstyle  }
%    \end{macrocode}
%
% \subsubsection{代码}
% 
% 代码样式。\\
% TODO: \st{style settings: finer or remove anything?} No plan. Removed
%    \begin{macrocode}
\lstset{
    basicstyle=\ttfamily\linespread{1}\small\selectfont,
    keywordstyle=\bfseries,         % use bold style for keywords
    commentstyle=\rmfamily\itshape, % use italic style for comments
    stringstyle=\ttfamily,
    flexiblecolumns,                % ?
    numbers=left,                   % left-aligned numbering
    showspaces=false,               % hide markers for spaces
    showstringspaces=false,
    captionpos=t,                   % place the caption at the top
    frame=tb,                       % show top & bottom sides of the frame
    % linewidth=.8\textwidth,
    % breakatwhitespace=true,
    breaklines=true,
    xleftmargin=1em,
    xrightmargin=1em,               % set the width of the code environment
}
%    \end{macrocode}
%
% \subsubsection{列表}
% 
% 列表环境。
%    \begin{macrocode}
\renewcommand{\labelitemi}{\large\textbullet}
\renewcommand{\labelitemii}{\normalsize\textbullet}
\renewcommand{\labelenumi}{\arabic{enumi}.}
\renewcommand{\labelenumii}{\alph{enumii}.}
%    \end{macrocode}
%
% 去除 item 之前的间隔。
%    \begin{macrocode}
\setlist[itemize]{noitemsep}
\setlist[enumerate]{noitemsep}
\setlist[description]{noitemsep}
%    \end{macrocode}
% 
% \subsection{定理环境}
%
%    \begin{macrocode}
\declaretheoremstyle[
  %spaceabove=.5\thm@preskip,
  %spacebelow=.5\thm@postskip,
  headfont=\bfseries\rmfamily\selectfont,% \scshape,
  notefont=\rmfamily\selectfont,% notebraces={ (}{)},
  bodyfont=\rmfamily\selectfont,
  %headformat={\NAME\space\NUMBER\space\NOTE},
  headpunct={},
  %postheadspace={.5em plus .1em minus .1em},
  %prefoothook={\hfill\qedsymbol}
]{hkustthm}

\theoremstyle{hkustthm}
%    \end{macrocode}
%
% 修改证明环境标题 。
%    \begin{macrocode}
\let\oldproofname=\proofname
\renewcommand*{\proofname}
  {\rmfamily\selectfont{\oldproofname}} 
%    \end{macrocode}
% 
%    \begin{macrocode}
\declaretheorem[
    name=Assumption,
    style=hkustthm,
    refname={assumption,assumptions},
    Refname={Assumption,Assumptions},
    % numberwithin=section,
]{assumption}
\declaretheorem[
    name=Axiom,
    style=hkustthm,
    refname={axiom,axioms},
    Refname={Axiom,Axioms},
    % numberwithin=section,
]{axiom}
\declaretheorem[
    name=Conclusion,
    style=hkustthm,
    refname={conclusion,conclusions},
    Refname={Conclusion,Conclusions},
    % numberwithin=section,
]{conclusion}
\declaretheorem[
    name=Condition,
    style=hkustthm,
    refname={condition,conditions},
    Refname={Condition,Conditions},
    % numberwithin=section,
]{condition}
\declaretheorem[
    name=Corollary,
    style=hkustthm,
    refname={corollary,corollaries},
    Refname={Corollary,Corollaries},
    % numberwithin=section,
]{corollary}
\declaretheorem[
    name=Definition,
    style=hkustthm,
    refname={definition,definitions},
    Refname={Definition,Definitions},
    % numberwithin=section,
]{definition}
\declaretheorem[
        name=Example,
        style=hkustthm,
        refname={example,examples},
        Refname={Example,Examples},
        % numberwithin=section,
]{example}
\declaretheorem[
    name=Lemma,
    style=hkustthm,
    refname={lemma,lemmas},
    Refname={Lemma,Lemmas},
    % numberwithin=section,
]{lemma}
\declaretheorem[
    name=Property,
    style=hkustthm,
    refname={property,properties},
    Refname={Property,Properties},
    % numberwithin=section,
]{property}
\declaretheorem[
    name=Proposition,
    style=hkustthm,
    refname={proposition,propositions},
    Refname={Proposition,Propositions},
    % numberwithin=section,
]{proposition}
\declaretheorem[
    name=Remark,
    style=hkustthm,
    refname={remark,remarks},
    Refname={Remark,Remarks},
    % numberwithin=section,
]{remark}
\declaretheorem[
    name=Theorem,
    style=hkustthm,
    refname={theorem,theorems},
    Refname={Theorem,Theorems},
    numberwithin=section,
]{theorem}
%</class>
%    \end{macrocode}
%
%%
%% \end{implementation}
%
